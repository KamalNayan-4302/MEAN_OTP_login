{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../services/auth.service\";\nimport * as i4 from \"@angular/common\";\nfunction VerifyOtpComponent_p_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"We've sent a 6-digit code to your email \");\n    i0.ɵɵelementStart(2, \"strong\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r0.email);\n  }\n}\nfunction VerifyOtpComponent_ng_container_6_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21);\n    i0.ɵɵelement(1, \"i\", 22);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r4.otpError, \" \");\n  }\n}\nfunction VerifyOtpComponent_ng_container_6_span_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 23);\n  }\n}\nfunction VerifyOtpComponent_ng_container_6_i_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"i\", 24);\n  }\n}\nfunction VerifyOtpComponent_ng_container_6_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵelement(1, \"i\", 24);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r7.successMessage, \" \");\n  }\n}\nfunction VerifyOtpComponent_ng_container_6_div_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21);\n    i0.ɵɵelement(1, \"i\", 22);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r8.error, \" \");\n  }\n}\nfunction VerifyOtpComponent_ng_container_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"form\", 6);\n    i0.ɵɵlistener(\"ngSubmit\", function VerifyOtpComponent_ng_container_6_Template_form_ngSubmit_1_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.onSubmit());\n    });\n    i0.ɵɵelementStart(2, \"div\", 7)(3, \"label\", 8);\n    i0.ɵɵtext(4, \"Enter Verification Code\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 9);\n    i0.ɵɵelement(6, \"input\", 10);\n    i0.ɵɵelementStart(7, \"div\", 11);\n    i0.ɵɵelement(8, \"i\", 12);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(9, VerifyOtpComponent_ng_container_6_div_9_Template, 3, 1, \"div\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"button\", 14);\n    i0.ɵɵtemplate(11, VerifyOtpComponent_ng_container_6_span_11_Template, 1, 0, \"span\", 15);\n    i0.ɵɵtemplate(12, VerifyOtpComponent_ng_container_6_i_12_Template, 1, 0, \"i\", 16);\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(14, VerifyOtpComponent_ng_container_6_div_14_Template, 3, 1, \"div\", 17);\n    i0.ɵɵtemplate(15, VerifyOtpComponent_ng_container_6_div_15_Template, 3, 1, \"div\", 13);\n    i0.ɵɵelementStart(16, \"div\", 18)(17, \"p\");\n    i0.ɵɵtext(18, \"Didn't receive the code?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"button\", 19);\n    i0.ɵɵlistener(\"click\", function VerifyOtpComponent_ng_container_6_Template_button_click_19_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.resendOTP());\n    });\n    i0.ɵɵelement(20, \"i\", 20);\n    i0.ɵɵtext(21, \" Resend Code \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.verifyForm);\n    i0.ɵɵadvance(5);\n    i0.ɵɵclassProp(\"error\", ctx_r1.otpError);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.otpError);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.loading || !ctx_r1.verifyForm.valid);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.loading);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.loading);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.loading ? \"Verifying...\" : \"Verify Code\", \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.successMessage);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.error);\n  }\n}\nfunction VerifyOtpComponent_ng_template_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 26);\n    i0.ɵɵelement(1, \"i\", 22);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 27)(4, \"a\", 28);\n    i0.ɵɵtext(5, \"Go to Registration\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.error, \" \");\n  }\n}\nexport let VerifyOtpComponent = /*#__PURE__*/(() => {\n  class VerifyOtpComponent {\n    constructor(formBuilder, router, route, authService) {\n      this.formBuilder = formBuilder;\n      this.router = router;\n      this.route = route;\n      this.authService = authService;\n      this.showOtpForm = true;\n      this.loading = false;\n      this.error = '';\n      this.successMessage = '';\n      this.email = '';\n      this.mobile = '';\n      this.submitted = false;\n      this.otpError = '';\n      this.verifyForm = this.formBuilder.group({\n        'otp': ['', [Validators.required]]\n      });\n    }\n    ngOnInit() {\n      this.route.queryParams.subscribe(params => {\n        if (params['email']) {\n          this.email = params['email'];\n          localStorage.setItem('pendingEmail', this.email);\n        } else {\n          this.email = localStorage.getItem('pendingEmail') || '';\n        }\n        if (params['mobile']) {\n          this.mobile = params['mobile'];\n          localStorage.setItem('pendingMobile', this.mobile);\n        } else {\n          this.mobile = localStorage.getItem('pendingMobile') || '';\n        }\n        console.log('VerifyOtpComponent ngOnInit - email:', this.email, 'mobile:', this.mobile);\n        if (!this.email && !this.mobile) {\n          this.error = 'Your session has expired or is invalid. Please register again.';\n          this.showOtpForm = false;\n        } else {\n          this.showOtpForm = true;\n        }\n      });\n    }\n    get f() {\n      return this.verifyForm.controls || {};\n    }\n    onSubmit() {\n      this.submitted = true;\n      this.otpError = '';\n      const otpValue = this.f['otp']?.value || '';\n      // Custom validation\n      if (!otpValue) {\n        this.otpError = 'Please enter the OTP';\n        return;\n      }\n      if (otpValue.length !== 6) {\n        this.otpError = 'Please enter exactly 6 digits';\n        return;\n      }\n      if (isNaN(parseInt(otpValue))) {\n        this.otpError = 'Please enter only numbers';\n        return;\n      }\n      this.loading = true;\n      if (this.email) {\n        this.authService.verifyEmailOtp(this.email, otpValue).subscribe(response => {\n          if (response.success) {\n            localStorage.removeItem('pendingEmail');\n            localStorage.removeItem('pendingMobile');\n            // Store user and token if present\n            if (response.user && response.token) {\n              localStorage.setItem('currentUser', JSON.stringify(response.user));\n              localStorage.setItem('token', response.token);\n            }\n            this.successMessage = 'OTP verified successfully! Redirecting to profile...';\n            setTimeout(() => {\n              this.router.navigate(['/otp-verified']);\n            }, 2000);\n          } else {\n            this.successMessage = 'OTP verification failed. Please try again.';\n            setTimeout(() => {\n              this.successMessage = '';\n            }, 3000);\n          }\n        }, error => {\n          this.error = error.message || 'Failed to verify OTP';\n          this.loading = false;\n        });\n      } else if (this.mobile) {\n        this.authService.verifyMobileOtp(this.mobile, otpValue).subscribe(response => {\n          if (response.success) {\n            localStorage.removeItem('pendingEmail');\n            localStorage.removeItem('pendingMobile');\n            this.successMessage = 'OTP verified successfully! Redirecting to profile...';\n            setTimeout(() => {\n              this.router.navigate(['/otp-verified']);\n            }, 2000);\n          } else {\n            this.successMessage = 'OTP verification failed. Please try again.';\n            setTimeout(() => {\n              this.successMessage = '';\n            }, 3000);\n          }\n        }, error => {\n          this.error = error.message || 'Failed to verify OTP';\n          this.loading = false;\n        });\n      } else {\n        this.error = 'No email or mobile found for OTP verification.';\n        this.loading = false;\n      }\n    }\n    resendOTP() {\n      if (!this.email) {\n        this.error = 'Email not found. Please go back to login.';\n        return;\n      }\n      this.loading = true;\n      this.error = '';\n      this.authService.resendEmailOtp(this.email).subscribe(response => {\n        if (response.success) {\n          this.successMessage = 'OTP resent successfully!';\n          setTimeout(() => {\n            this.successMessage = '';\n          }, 3000);\n        }\n        this.loading = false;\n      }, error => {\n        this.error = error.message || 'Failed to resend OTP';\n        this.loading = false;\n      });\n    }\n    static {\n      this.ɵfac = function VerifyOtpComponent_Factory(t) {\n        return new (t || VerifyOtpComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i2.ActivatedRoute), i0.ɵɵdirectiveInject(i3.AuthService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: VerifyOtpComponent,\n        selectors: [[\"app-verify-otp\"]],\n        decls: 9,\n        vars: 3,\n        consts: [[1, \"container\"], [1, \"card\"], [1, \"card-header\"], [4, \"ngIf\"], [4, \"ngIf\", \"ngIfElse\"], [\"expiredBlock\", \"\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"otp-input-container\"], [\"for\", \"otp\"], [1, \"otp-input-wrapper\"], [\"type\", \"text\", \"formControlName\", \"otp\", \"id\", \"otp\", \"maxlength\", \"6\", \"placeholder\", \"000000\", 1, \"otp-input\"], [1, \"input-icon\"], [1, \"fas\", \"fa-shield-alt\"], [\"class\", \"error-message\", 4, \"ngIf\"], [\"type\", \"submit\", 1, \"verify-btn\", 3, \"disabled\"], [\"class\", \"spinner\", 4, \"ngIf\"], [\"class\", \"fas fa-check-circle\", 4, \"ngIf\"], [\"class\", \"success-message\", 4, \"ngIf\"], [1, \"resend-section\"], [\"type\", \"button\", 1, \"resend-btn\", 3, \"click\"], [1, \"fas\", \"fa-redo\"], [1, \"error-message\"], [1, \"fas\", \"fa-exclamation-circle\"], [1, \"spinner\"], [1, \"fas\", \"fa-check-circle\"], [1, \"success-message\"], [1, \"error-message\", 2, \"margin\", \"2em 0\", \"text-align\", \"center\"], [2, \"text-align\", \"center\"], [\"routerLink\", \"/register\", 1, \"btn\", \"btn-primary\"]],\n        template: function VerifyOtpComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h2\");\n            i0.ɵɵtext(4, \"Verify Your Email Address\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(5, VerifyOtpComponent_p_5_Template, 4, 1, \"p\", 3);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(6, VerifyOtpComponent_ng_container_6_Template, 22, 10, \"ng-container\", 4);\n            i0.ɵɵtemplate(7, VerifyOtpComponent_ng_template_7_Template, 6, 1, \"ng-template\", null, 5, i0.ɵɵtemplateRefExtractor);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            const _r2 = i0.ɵɵreference(8);\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngIf\", ctx.showOtpForm);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.showOtpForm)(\"ngIfElse\", _r2);\n          }\n        },\n        dependencies: [i4.NgIf, i2.RouterLink, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.MaxLengthValidator, i1.FormGroupDirective, i1.FormControlName],\n        styles: [\".verify-otp[_ngcontent-%COMP%]{max-width:400px;margin:20px auto;padding:20px;background:white;border-radius:8px;box-shadow:0 2px 4px #0000001a}.verify-otp[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:20px}.verify-otp[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:16px}.verify-otp[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{color:#dc3545;font-size:14px;margin-top:5px}.verify-otp[_ngcontent-%COMP%]   .success[_ngcontent-%COMP%]{color:#28a745;font-size:14px;margin-top:5px;font-weight:500}.verify-otp[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:10px 20px;border-radius:4px;cursor:pointer;font-size:16px}.verify-otp[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none}.verify-otp[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover{background-color:#0056b3}\"]\n      });\n    }\n  }\n  return VerifyOtpComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}